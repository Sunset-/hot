!function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(42)},function(t,e){var n=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=n)},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,n){t.exports=!n(2)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e){var n=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:n)(t)}},function(t,e,n){var r=n(10),o=n(6);t.exports=function(t){return r(o(t))}},function(t,e,n){var r=n(4),o=n(1),i=n(18),a=n(22),s="prototype",c=function(t,e,n){var u,f,p,l=t&c.F,h=t&c.G,d=t&c.S,v=t&c.P,_=t&c.B,y=t&c.W,g=h?o:o[e]||(o[e]={}),m=g[s],b=h?r:d?r[e]:(r[e]||{})[s];h&&(n=e);for(u in n)f=!l&&b&&void 0!==b[u],f&&u in g||(p=f?b[u]:n[u],g[u]=h&&"function"!=typeof b[u]?n[u]:_&&f?i(p,r):y&&b[u]==p?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e[s]=t[s],e}(p):v&&"function"==typeof p?i(Function.call,p):p,v&&((g.virtual||(g.virtual={}))[u]=p,t&c.R&&m&&!m[u]&&a(m,u,p)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},function(t,e,n){var r=n(17);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)}},function(t,e,n){var r=n(25),o=n(20);t.exports=Object.keys||function(t){return r(t,o)}},function(t,e,n){var r=n(6);t.exports=function(t){return Object(r(t))}},function(t,e,n){n(34),t.exports=n(1).Object.keys},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,n){var r=n(5);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},function(t,e,n){var r=n(8),o=n(31),i=n(30);t.exports=function(t){return function(e,n,a){var s,c=r(e),u=o(c.length),f=i(a,u);if(t&&n!=n){for(;u>f;)if(s=c[f++],s!=s)return!0}else for(;u>f;f++)if((t||f in c)&&c[f]===n)return t||f||0;return!t&&-1}}},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e,n){var r=n(14);t.exports=function(t,e,n){if(r(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}}},function(t,e,n){var r=n(5),o=n(4).document,i=r(o)&&r(o.createElement);t.exports=function(t){return i?o.createElement(t):{}}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e,n){var r=n(24),o=n(27);t.exports=n(3)?function(t,e,n){return r.f(t,e,o(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e,n){t.exports=!n(3)&&!n(2)(function(){return 7!=Object.defineProperty(n(19)("div"),"a",{get:function(){return 7}}).a})},function(t,e,n){var r=n(15),o=n(23),i=n(32),a=Object.defineProperty;e.f=n(3)?Object.defineProperty:function(t,e,n){if(r(t),e=i(e,!0),r(n),o)try{return a(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},function(t,e,n){var r=n(21),o=n(8),i=n(16)(!1),a=n(28)("IE_PROTO");t.exports=function(t,e){var n,s=o(t),c=0,u=[];for(n in s)n!=a&&r(s,n)&&u.push(n);for(;e.length>c;)r(s,n=e[c++])&&(~i(u,n)||u.push(n));return u}},function(t,e,n){var r=n(9),o=n(1),i=n(2);t.exports=function(t,e){var n=(o.Object||{})[t]||Object[t],a={};a[t]=e(n),r(r.S+r.F*i(function(){n(1)}),"Object",a)}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,n){var r=n(29)("keys"),o=n(33);t.exports=function(t){return r[t]||(r[t]=o(t))}},function(t,e,n){var r=n(4),o="__core-js_shared__",i=r[o]||(r[o]={});t.exports=function(t){return i[t]||(i[t]={})}},function(t,e,n){var r=n(7),o=Math.max,i=Math.min;t.exports=function(t,e){return t=r(t),t<0?o(t+e,0):i(t,e)}},function(t,e,n){var r=n(7),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},function(t,e,n){var r=n(5);t.exports=function(t,e){if(!r(t))return t;var n,o;if(e&&"function"==typeof(n=t.toString)&&!r(o=n.call(t)))return o;if("function"==typeof(n=t.valueOf)&&!r(o=n.call(t)))return o;if(!e&&"function"==typeof(n=t.toString)&&!r(o=n.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,e){var n=0,r=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+r).toString(36))}},function(t,e,n){var r=n(12),o=n(11);n(26)("keys",function(){return function(t){return o(r(t))}})},function(t,e,n){t.exports={default:n(13),__esModule:!0}},function(t,e,n){n(40),t.exports=n(1).Object.assign},function(t,e,n){"use strict";var r=n(11),o=n(38),i=n(39),a=n(12),s=n(10),c=Object.assign;t.exports=!c||n(2)(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=c({},t)[n]||Object.keys(c({},e)).join("")!=r})?function(t,e){for(var n=a(t),c=arguments.length,u=1,f=o.f,p=i.f;c>u;)for(var l,h=s(arguments[u++]),d=f?r(h).concat(f(h)):r(h),v=d.length,_=0;v>_;)p.call(h,l=d[_++])&&(n[l]=h[l]);return n}:c},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e){e.f={}.propertyIsEnumerable},function(t,e,n){var r=n(9);r(r.S+r.F,"Object",{assign:n(37)})},function(t,e,n){t.exports={default:n(36),__esModule:!0}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var o=n(35),i=r(o),a=n(41),s=r(a);!function(){function t(t){throw alert(t),new Error(t)}function e(t,e){var n=c;if(t&&t.length){for(var r=t.split("."),o=0,i=r.length;o<i;o++){if(void 0==n[r[o]])return e;n=n[r[o]]}return n}return e}var n={echarts:"echarts",BMap:"百度地图",jQuery:"jQuery"},r={strokeColor:"blue",strokeWeight:2,strokeOpacity:.5},o={strokeColor:"orange",fillColor:"red",fillOpacity:.2,strokeWeight:2,strokeOpacity:.5},a={strokeColor:"orange",fillColor:"red",fillOpacity:.2,strokeWeight:2,strokeOpacity:.5},c={},u=[];window.HeatSourceMapApp={thens:[],inited:!1,state:{nodes:{},point_node:{},pipes:{}},init:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._checkDepLibs(),this.state.edit=!!e.edit,e.container&&this._initEchartsMap(e),{then:function(e){t.inited?e.call(t):t.thens.push(e)}}},config:function(t){(0,s.default)(c,t)},_checkDepLibs:function(){(0,i.default)(n).forEach(function(e){window[e]||t("未引入"+n[e]+"库")})},_initEchartsMap:function(t){var e=new BMap.Map($(t.container)[0],{enableMapClick:!1});for(e.centerAndZoom(new BMap.Point(t.center[0],t.center[1]),t.zoom),e.enableScrollWheelZoom(),this.bmap=e,this._initMapEvents();this.thens.length;)this.thens.shift().call(this);return this.inited=!0,void e.setMapStyle(t.mapStyle)},_initMapEvents:function(){var t=this;this.bmap.addEventListener("zoomend",function(e){t.refresh()}),this.bmap.addEventListener("click",function(t){u.push(t.point.lng+","+t.point.lat),console.log(u.join(";")),window.globalAddNodeOrPipe&&window.globalAddNodeOrPipe(t)})},addNodes:function(t,e){var n=this;this.removeNodes(e);var r=this.state.nodes;return t&&t.forEach(function(t){n._buildNode(t),n._bindNodeEvent(t),(r[t.type]||(r[t.type]=[])).push(t),n.state.point_node[t._point.lng+","+t._point.lat]=t}),setTimeout(function(){n.refresh(t)},0),t},getNodeByPoint:function(t){return!this.state.point_node[t],this.state.point_node[t]},removeNodes:function(t){if(t){var e=this.bmap;if(t===!0)this.state.nodes={},this.state.point_node={},e.clearOverlays();else{var n=this.state.nodes[t],r=this.state.point_node;if(n){for(var o;n.length;)o=n.pop(),delete r[o._point.lng+","+o._point.lat],e.removeOverlay(o._marker),o._region&&e.removeOverlay(o._region),o._marker=null,o._region=null;delete this.state.nodes[t]}}}},_buildNode:function(t){var n=this,r=this.bmap,s=new BMap.Point(t.coord[0],t.coord[1]);t._point=s;var c=new BMap.Marker(s);if(r.addOverlay(c),t._marker=c,t._overlays=[t._marker],this._changeNodeIcon(t),t.region){var u=t.region.split(";").map(function(t){var e=t.split(",");return new BMap.Point(+e[0],+e[1])}),f=new BMap.Polygon(u,e("regionStyles."+t.type+".normal",o));r.addOverlay(f),t._region=f,t._overlays.push(t._region),t._region.addEventListener("mouseover",function(){n._changeAreaStyle(t._region,e("regionStyles."+t.type+".active",a))}),t._region.addEventListener("mouseout",function(){n._changeAreaStyle(t._region,e("regionStyles."+t.type+".normal",o))})}this.state.edit&&(t._marker._type=t.type,t._marker.enableDragging(),t._region&&t._region.enableEditing(),t._marker.addEventListener("click",function(t){window.globalOperateNodeAndPipe&&window.globalOperateNodeAndPipe(t,t.target)}),t._marker.addEventListener("dragend",function(e){var r=t._point,o=e.point;t._point=e.point,t.coord=[e.point.lng,e.point.lat];var a=n.state.pipes;(0,i.default)(a).forEach(function(t){var e=a[t];e.forEach(function(t){var e=t._line.getPath();e[0].equals(r)&&(e[0]=o),e[e.length-1].equals(r)&&(e[e.length-1]=o),t._line.setPath(e)})})}))},_changeAreaStyle:function(t,e){t&&e&&(0,i.default)(e).forEach(function(n){var r="set"+(n.substr(0,1).toUpperCase()+n.substring(1,n.length));t[r]&&t[r](e[n])})},_changeNodeIcon:function(t){var e=c.nodeIcons&&c.nodeIcons[t.type];if(e){var n;n="function"==typeof e?e(t.data):e;var r=t._marker;if(r){var o=(n.size||"30,30").split(","),i=(n.anchor||"0,0").split(","),a=(n.offset||"0,0").split(","),s=n.imageSize&&n.imageSize.split(","),u={anchor:new BMap.Size(i[0],i[1]),imageOffset:new BMap.Size(a[0],a[1])};s&&2==s.length&&(u.imageSize=new BMap.Size(s[0],s[1]));var f=new BMap.Icon(n.url,new BMap.Size(o[0],o[1]),u);t._iconOffset={width:o[0],height:o[1]},r.setIcon(f)}}},_bindNodeEvent:function(t){var n=this;t._marker.addEventListener("mouseover",function(){n._openInfoWindow(t,t._marker.point)}),t._marker.addEventListener("mouseout",function(){n.bmap.closeInfoWindow()}),t._marker.addEventListener("click",function(){var n=e("click."+t.type)||e("click");if("function"==typeof n){var r=e("beforeClick."+t.type)||e("beforeClick");if("function"==typeof r&&r.call(null,t.data)===!1)return;n.call(null,t.data)}})},addPipes:function(t,e){var n=this;this.removePipes(e);var r=this.state.pipes;return t&&t.forEach(function(t){t.path&&(n._buildPipe(t),n._alarmPipe(t),n._bindPipeEvent(t),(r[t.type]||(r[t.type]=[])).push(t))}),setTimeout(function(){n.refresh(null,t)},0),t},removePipes:function(t){if(t){var e=this.bmap;if(t===!0)this.state.pipes={},e.clearOverlays();else{var n=this.state.pipes[t];if(n){for(;n.length;){var r=n.pop();e.removeOverlay(r._line),r._line=null}delete this.state.pipes[t]}}}},_buildPipe:function(t){var e=this.bmap,n=[],r=new BMap.Polyline(t.path.split(";").map(function(t){var e=t.split(",").map(function(t){return+t.trim()});return n.push(e),new BMap.Point(e[0],e[1])}));t._line=r,t._points=n,this._changePipeStyle(t),e.addOverlay(t._line),t._overlays=[t._line],this.state.edit&&(t._line._type=t.type,r.enableEditing(),r.addEventListener("click",function(t){window.globalOperateNodeAndPipe&&window.globalOperateNodeAndPipe(t,t.target)}))},_changePipeStyle:function(t,e){e=e||c.pipeStyles&&c.pipeStyles[t.type];var n;n=e?"function"==typeof e?e(t.data,this._getPipeTerminalDatas(t)):e:r;var o=t._line;(0,i.default)(n).forEach(function(t){var e="set"+(t.substr(0,1).toUpperCase()+t.substring(1,t.length));o[e]&&o[e](n[t])})},_getPipeTerminals:function(t){if(t._points)return{start:this.getNodeByPoint(t._points[0].join(",")),end:this.getNodeByPoint(t._points[t._points.length-1].join(","))}},_getPipeTerminalDatas:function(t){var e=this._getPipeTerminals(t);return e&&{start:e.start&&e.start.data,end:e.end&&e.end.data}},_alarmPipe:function(t){var e=this,n=c.alarms&&c.alarms[t.type];if(n&&"function"==typeof n.check&&n.check(t.data,this._getPipeTerminalDatas(t))){clearTimeout(t._alarmTimer);var r=!1;t._alarmTimer=setInterval(function(){r=!r,e._changePipeStyle(t,r&&n.style)},c.alarmInterval||1e3)}},_bindPipeEvent:function(t){var e=this;t._line.addEventListener("mouseover",function(n){e._openInfoWindow(t,n.point)}),t._line.addEventListener("mouseout",function(n){e.bmap.closeInfoWindow(t,n.point)})},refresh:function(t,e){var n=this;if(t||e)t&&this._refreshOverlays(t),e&&this._refreshOverlays(e);else{var r=this.state.nodes,o=this.state.pipes;(0,i.default)(r).forEach(function(t){r[t]&&n._refreshOverlays(r[t])}),(0,i.default)(o).forEach(function(t){o[t]&&n._refreshOverlays(o[t])})}},_refreshOverlays:function(t){var e=this.bmap.getZoom();t.forEach(function(t){var n=t.zoom||c.zooms&&c.zooms[t.type];isNaN(n)||(e>=n?t._overlays.forEach(function(t){return t.show()}):t._overlays.forEach(function(t){return t.hide()}))})},_refreshPipes:function(t){this.mapChart.setOption({series:[{type:"lines",coordinateSystem:"bmap",polyline:!0,data:t.push,silent:!0,lineStyle:{normal:{opacity:.3,width:2}},progressiveThreshold:500,progressive:200}]})},_openInfoWindow:function(t,n){var r=e("info."+t.type)||e("info");if(r){if("function"!=typeof r)throw new Error("信息框回调必须为一个function");var o=t.data,i=this._getPipeTerminalDatas(t),a=e("beforeInfo."+t.type)||e("beforeInfo");if("function"!=typeof a||a.call(null,o,i)!==!1){if(!t._infoWindow){var s=t._iconOffset||{},c={offset:new BMap.Size(0,-(s.height||0))},u=r.call(null,o,i);t._infoWindow=new BMap.InfoWindow(u,c)}this.bmap.openInfoWindow(t._infoWindow,n||t._point)}}},search:function(t){if("function"!=typeof t)throw new Error("过滤条件应为一个function");var e=this.state.nodes,n=this.state.pipes,r=[],o=[];return(0,i.default)(e).forEach(function(n){e[n].forEach(function(e){t(e.data)&&(o.push(e.data),r.push(e._marker.point))})}),(0,i.default)(n).forEach(function(e){n[e].forEach(function(e){t(e.data)&&(o.push(e.data),r=r.concat(e.getPath()))})}),r.length&&this.bmap.setViewport(r),o}}}()}]);